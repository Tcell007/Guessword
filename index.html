<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Word Guessing — Input / Display</title>
  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --accent-start:#d7e7ff;
      --accent-end:#e6f7ff;
      --pastel-1: #ffdede;
      --pastel-2: #eaffde;
      --pastel-3: #e8deff;
      --shadow: 0 10px 20px rgba(20,30,80,0.06);
      --radius:14px;
      --tile-radius:10px;
    }
    *{box-sizing:border-box;font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#fbfbff);color:#1f2937}
    .app{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    .title{display:flex;align-items:center;gap:12px}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent-start),var(--accent-end));display:flex;align-items:center;justify-content:center;font-weight:700;color:#08306b;box-shadow:var(--shadow)}
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:#475569}
    .tabs{display:flex;gap:8px}
    .tab{padding:10px 16px;border-radius:10px;background:linear-gradient(90deg,rgba(255,255,255,0.6),rgba(255,255,255,0.4));border:1px solid rgba(0,0,0,0.04);cursor:pointer}
    .tab.active{background:linear-gradient(90deg,#e6f7ff,#fff2e6);box-shadow:0 6px 18px rgba(30,60,120,0.06);font-weight:600}

    .container{display:flex;gap:18px}
    .left,.right{flex:1}
    .card{background:var(--card);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)}

    /* Input form */
    .groups{display:flex;flex-direction:column;gap:12px}
    .group-row{display:grid;grid-template-columns:1fr 2fr auto;gap:10px;align-items:start}
    .group-row input[type="text"], .group-row textarea{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(15,23,42,0.06);resize:vertical}
    .group-row textarea{min-height:64px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;background:linear-gradient(90deg,#89f7fe,#66a6ff);color:#00303f;font-weight:600}
    .btn.secondary{background:linear-gradient(90deg,#ffd9e8,#ffdca6);}
    .controls{display:flex;gap:10px;align-items:center;margin-top:12px}

    /* Lock overlay */
    .locked{position:relative}
    .lock-overlay{position:absolute;inset:0;background:linear-gradient(90deg,rgba(255,255,255,0.7),rgba(240,248,255,0.6));backdrop-filter:blur(3px);display:flex;align-items:center;justify-content:center;border-radius:var(--radius)}
    .lock-card{background:linear-gradient(135deg,#fff,#f8fbff);padding:18px;border-radius:12px;box-shadow:0 8px 24px rgba(10,20,50,0.06);text-align:center}

    /* Display */
    .group-card{padding:12px;border-radius:12px;background:linear-gradient(180deg,#fff,#fbfdff);border:1px solid rgba(10,20,40,0.03)}
    .group-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .tiles{display:flex;flex-wrap:wrap;gap:10px}
    .tile{position:relative;min-width:110px;padding:14px 12px;border-radius:var(--tile-radius);box-shadow:0 6px 14px rgba(20,30,80,0.04);display:flex;align-items:center;justify-content:center;font-weight:600;background:linear-gradient(180deg,#fff,#fcfdff);cursor:default}
    .tile:hover{transform:translateY(-4px);transition:transform .18s}
    .cover{position:absolute;inset:0;border-radius:var(--tile-radius);display:flex;align-items:center;justify-content:center;font-weight:700;color:rgba(255,255,255,0.9);font-size:18px}
    .cover.p1{background:linear-gradient(135deg,var(--pastel-1),#ffdfe6)}
    .cover.p2{background:linear-gradient(135deg,var(--pastel-2),#e6ffe6)}
    .cover.p3{background:linear-gradient(135deg,var(--pastel-3),#efe6ff)}
    .cover.hidden{pointer-events:none;animation:reveal .5s forwards}

    @keyframes reveal{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(1.12)}}

    .blink{animation:blink 1s ease-in-out 3;box-shadow:0 0 0 6px rgba(255,255,255,0.12) inset}
    @keyframes blink{0%{box-shadow:0 0 0 0 rgba(255,255,255,0)}50%{box-shadow:0 0 0 8px rgba(255,255,255,0.35)}100%{box-shadow:0 0 0 0 rgba(255,255,255,0)}}

    .wrong-list{margin-top:10px;display:flex;flex-wrap:wrap;gap:8px}
    .wrong-item{padding:6px 10px;border-radius:999px;border:1px dashed rgba(30,40,60,0.08);cursor:pointer}

    .stats{margin-top:10px;color:#334155;font-weight:600}

    /* small */
    .muted{color:#6b7280;font-size:13px}
    .small{font-size:13px}

    /* responsive */
    @media(max-width:900px){.container{flex-direction:column}.group-row{grid-template-columns:1fr} }

  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title">
        <div class="logo">WG</div>
        <div>
          <h1>Word Guessing — Input & Display</h1>
          <p class="lead muted">สร้างกลุ่มคำ แล้วให้ผู้เล่นพิมพ์คำเพื่อเปิดป้าย</p>
        </div>
      </div>
      <div class="tabs" role="tablist">
        <div id="tab-input" class="tab active">Input</div>
        <div id="tab-display" class="tab">Display</div>
      </div>
    </header>

    <div class="container">
      <div class="left">
        <div id="inputCard" class="card locked">
          <h3>ตั้งชื่อกลุ่ม และใส่คำศัพท์ (บรรทัดละคำ)</h3>
          <div style="margin-top:10px" class="muted small">สร้างหลายกลุ่มได้ — แต่ละกลุ่มจะเป็นบล็อกแยกกันเมื่อแสดงผล</div>
          <div style="height:12px"></div>

          <div class="groups" id="groupsContainer">
            <!-- dynamic group rows -->
          </div>

          <div class="controls">
            <button id="addGroupBtn" class="btn secondary">+ เพิ่มกลุ่ม</button>
            <button id="createBtn" class="btn">สร้างกล่องคำ</button>
            <div style="flex:1"></div>
            <div class="muted small">สถานะ: <span id="inputState">Ready</span></div>
          </div>

          <!-- lock overlay (activated after create) -->
          <div id="lockOverlay" class="lock-overlay" style="display:none">
            <div class="lock-card">
              <div style="font-weight:700;margin-bottom:6px">Input ถูกล็อก</div>
              <div class="muted small">ถ้าต้องการแก้ไขอีกครั้ง คลิก "ปลดล็อก" แล้วยืนยัน</div>
              <div style="height:10px"></div>
              <button id="unlockBtn" class="btn">ปลดล็อก</button>
            </div>
          </div>
        </div>
      </div>

      <div class="right">
        <div class="card">
          <h3>Display</h3>
          <div class="muted small">พิมพ์คำเพื่อทายคำในกลุ่ม (ไม่สนตัวพิมพ์ใหญ่/เล็ก)</div>
          <div style="height:12px"></div>

          <div style="display:flex;gap:8px;align-items:center}">
            <input id="guessInput" type="text" placeholder="พิมพ์คำที่จะทาย แล้วกด Check หรือ Enter" style="flex:1;padding:10px;border-radius:10px;border:1px solid rgba(10,20,40,0.06)" />
            <button id="checkBtn" class="btn">Check</button>
          </div>

          <div id="stats" class="stats"></div>

          <div id="groupsDisplay" style="margin-top:12px;display:flex;flex-direction:column;gap:12px"></div>

        </div>
      </div>
    </div>
  </div>

  <script>
    // State
    let groups = [];
    let locked = false;

    const groupsContainer = document.getElementById('groupsContainer');
    const groupsDisplay = document.getElementById('groupsDisplay');
    const addGroupBtn = document.getElementById('addGroupBtn');
    const createBtn = document.getElementById('createBtn');
    const lockOverlay = document.getElementById('lockOverlay');
    const unlockBtn = document.getElementById('unlockBtn');
    const inputState = document.getElementById('inputState');

    const tabInput = document.getElementById('tab-input');
    const tabDisplay = document.getElementById('tab-display');
    const inputCard = document.getElementById('inputCard');

    const guessInput = document.getElementById('guessInput');
    const checkBtn = document.getElementById('checkBtn');
    const stats = document.getElementById('stats');

    function makeGroupRow(group = {name:'', words:[]}){
      const id = Math.random().toString(36).slice(2,9);
      const div = document.createElement('div');
      div.className='group-row';
      div.dataset.id = id;

      const nameInput = document.createElement('input');
      nameInput.type='text'; nameInput.placeholder='ชื่อกลุ่ม (เช่น กลุ่ม A)'; nameInput.value = group.name;

      const ta = document.createElement('textarea');
      ta.placeholder='พิมพ์คำแต่ละคำในบรรทัดใหม่ เช่น:\napple\nbanana\ncherry';
      ta.value = (group.words||[]).join('\n');

      const del = document.createElement('button');
      del.className='btn'; del.textContent='ลบ';
      del.onclick = ()=>{ groupsContainer.removeChild(div); }

      div.appendChild(nameInput); div.appendChild(ta); div.appendChild(del);
      groupsContainer.appendChild(div);
      return {id,nameInput,ta,el:div};
    }

    // Initially add two groups
    makeGroupRow({name:'กลุ่ม 1', words:['apple','banana']});

    addGroupBtn.onclick = ()=>{ makeGroupRow({name:'กลุ่ม ใหม่', words:[]}); }

    function readInputGroups(){
      groups = [];
      Array.from(groupsContainer.children).forEach(r=>{
        const name = r.querySelector('input').value.trim() || 'ไม่ระบุ';
        const raw = r.querySelector('textarea').value.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
        const words = raw.map(w=>w);
        groups.push({name, words, revealed: new Array(words.length).fill(false), wrong: []});
      });
    }

    createBtn.onclick = ()=>{
      readInputGroups();
      if(groups.length===0){alert('กรุณาเพิ่มกลุ่มคำอย่างน้อย 1 กลุ่ม');return}
      // lock input
      locked = true;
      lockOverlay.style.display='flex';
      inputState.textContent = 'Locked';
      renderDisplay();
      // Switch to Display tab
      activateTab('display');
    }

    unlockBtn.onclick = ()=>{
      if(!confirm('ต้องการปลดล็อก Input เพื่อแก้ไขหรือไม่?')) return;
      locked = false; lockOverlay.style.display='none'; inputState.textContent='Ready';
    }

    function activateTab(which){
      if(which==='input'){
        tabInput.classList.add('active'); tabDisplay.classList.remove('active');
        inputCard.style.display='block';
      }else{
        tabDisplay.classList.add('active'); tabInput.classList.remove('active');
        inputCard.style.display='block';
      }
    }

    tabInput.onclick = ()=>{ if(locked){ alert('Input ถูกล็อกอยู่ — หากต้องการแก้ไข ให้ไปกด "ปลดล็อก" ที่ Input'); } else { tabInput.classList.add('active'); tabDisplay.classList.remove('active'); } }
    tabDisplay.onclick = ()=>{ tabDisplay.classList.add('active'); tabInput.classList.remove('active'); }

    // Rendering Display
    function renderDisplay(){
      groupsDisplay.innerHTML='';
      let total = 0, opened=0;
      groups.forEach((g,gi)=>{
        const card = document.createElement('div'); card.className='group-card';
        const title = document.createElement('div'); title.className='group-title';
        const left = document.createElement('div'); left.innerHTML = `<strong>${g.name}</strong><div class="muted small">${g.words.length} คำ</div>`;
        const right = document.createElement('div'); right.className='muted small';
        title.appendChild(left); title.appendChild(right);
        card.appendChild(title);

        const tilesWrap = document.createElement('div'); tilesWrap.className='tiles';

        g.words.forEach((w,wi)=>{
          total++;
          const tile = document.createElement('div'); tile.className='tile'; tile.dataset.group=gi; tile.dataset.index=wi;
          const txt = document.createElement('div'); txt.textContent = w; tile.appendChild(txt);

          const cover = document.createElement('div'); cover.className='cover ' + (['p1','p2','p3'][wi%3]); cover.textContent = '?';
          if(g.revealed[wi]){ cover.classList.add('hidden'); }
          tile.appendChild(cover);
          tilesWrap.appendChild(tile);
          if(g.revealed[wi]) opened++;
        });

        card.appendChild(tilesWrap);

        // wrong list
        const wrongList = document.createElement('div'); wrongList.className='wrong-list';
        (g.wrong||[]).forEach((wrd,idx)=>{
          const wi = document.createElement('div'); wi.className='wrong-item'; wi.textContent=wrd; wi.onclick = ()=>{ g.wrong.splice(idx,1); renderDisplay(); };
          wrongList.appendChild(wi);
        });
        card.appendChild(wrongList);

        // stats update
        const rcount = g.revealed.filter(Boolean).length;
        right.innerHTML = `<span class="small">เปิดแล้ว ${rcount} / ${g.words.length}</span>`;

        groupsDisplay.appendChild(card);
      });

      stats.innerHTML = `รวม: เปิดแล้ว <strong>${opened}</strong> / รวม <strong>${total}</strong> คำ`;
    }

    function matchGuess(guess){
      if(!guess) return;
      const gLower = guess.trim().toLowerCase();
      let found = false;
      groups.forEach((g,gi)=>{
        g.words.forEach((w,wi)=>{
          if(!g.revealed[wi] && w.toLowerCase()===gLower){
            // reveal
            g.revealed[wi]=true; found=true;
            // show animation: add hidden class to cover, blink tile
            // we'll re-render and then trigger blink on the tile element
          }
        });
      });

      if(found){
        renderDisplay();
        // find tile elements that were revealed this turn and add blink
        setTimeout(()=>{
          document.querySelectorAll('.tile').forEach(t=>{
            const gi = +t.dataset.group, wi = +t.dataset.index;
            if(groups[gi] && groups[gi].revealed[wi]){
              t.classList.add('blink');
              setTimeout(()=>t.classList.remove('blink'), 1500);
            }
          });
        },50);
      } else {
        // add to wrong lists for all groups? instruction: "ให้แสดงผลข้อความนั้นในบรรทัดต่อมาจากกลุ่มคำหลัก" - so add under each group as suggestion to allow clicking to remove
        // We'll add it to the first group that doesn't already have the wrong item
        if(groups.length===0) return;
        // choose group by simple round-robin: push into groups[0]
        const target = groups[0];
        if(!target.wrong.includes(guess)) target.wrong.push(guess);
        renderDisplay();
      }
    }

    checkBtn.onclick = ()=>{ const val = guessInput.value.trim(); if(!val) return; matchGuess(val); guessInput.value=''; guessInput.focus(); }
    guessInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); checkBtn.click(); } });

    // initial render
    renderDisplay();

    // small helper: if user unlocks, let them edit; when they re-create, re-lock
    // Save/Restore not implemented — everything in-memory

  </script>
</body>
</html>
